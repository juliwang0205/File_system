## 模拟文件系统

## 一、设计
将一个大文件当作是模拟的硬盘，包括三个区域：superblock, inode, 扇区。

文件 disk.img 共100MB，按照每个扇区 512B 来计算，共有204800个扇区。



### 二、superblock
记录inode和扇区的分配情况。占用512(256KB)个扇区,。使用位图的形式来记录inode和数据区的分配情况。

256个扇区来记录inode的分配情况，inode共占用8192个扇区。也就是用了4MB的磁盘来存放inode。

256个扇区来记录数据扇区的分配情况，数据扇区共131072个扇区。也就是说磁盘中64MB用来存放数据。

### 三、inode
记录文件和目录的信息,和占用的数据扇区的信息。每个inode节点32字节，一个扇区可以存放16个inode节点。共占用了8192个扇区。


inode包括这样几个信息:

1. inode号码，这与目录中的inode号码对应
2. 文件类型，是目录还是文件
3. 文件大小，文件的具体大小
4. 文件起始扇区号
5. 文件占用的扇区数量

其中，0号inode是根目录`/`,根据根目录的数据扇区号，可以找到磁盘中对该文件夹的描述。

### 四、数据扇区
存放文件和目录信息，两者会有比较大的区别。

#### 4.1文件
  每个扇区的前508个字节存放数据，最后一个字节指向下一个数据扇区，如果没有就置为-1。

  |字节|0 - 507|508 - 511|
  |--|--|--|
  |作用|存放数据|指向下一个数据扇区|

#### 4.2目录
  存放该目录下的文件名称和对应的文件indoe号码。例如：

##### 目录结构示例：
  |文件或目录名|对应的inode号码|
  |--|--|
  |.|1|
  |..|1|
  |bin|2|
  |etc|3|
  |home|4|
  |dev|5|
  |^|^|
  |next|next_num|

其中要求文件或目录名不超过28字节，后四位用来保存inode号码，如果一个扇区不够，最后一项指向下一个扇区。

根目录对应的inode为1。类似的`home`目录结构如下：

|文件或目录名|对应的inode号码|
|--|--|
|.|4|
|..|1|
|tr|6|
|^|^|

home自己的inode号为4，home目录上一层是根目录，对应inode为1。这个目录中有一个文件tr，其inode号码为6。


### 五、缓存
模拟磁盘的IO全部从这里经过。
会动态地检查节点的状态，将长时间没用的缓存写回磁盘


### 六、实现以下文件API

```c++
void ls();
int fopen(char* name, int mode);
void fclose(int fd);
int fread(int fd, char* buffer, int length);
int fwrite(int fd, char* buffer, int length);
int flseek(int fd, int position);
int fcreat(char* name, int mode);
int fdelete(char* name);
```
#### 需要完成的功能：
  1. 将宿主机的文件存入虚拟磁盘。
  2. 将虚拟磁盘的文件取出，放在宿主机。要求文件没有损坏。
  3. 创建新目录。
  4. 删除已经存在的目录。

#### 需要编写的两个应用程序：
  1. initialize，用来初始化虚拟磁盘。
  2. testMyFileSystem，接受用户输入的文件操作命令，测试文件系统和API。

### 七、需要提交的材料
  1. Makefile 文件
  2. README.md 文件
  3. 项目设计报告
